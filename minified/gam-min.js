function runGam(){function e(e){return document.getElementById(e)}function t(e){return document.createElement(e)}function i(e){return document.createTextNode(e)}function l(e,i){let l=t("IMG");void 0!==i&&(l.id=i),l.alt="Click or tap to close",l.classList.add("closeButton"),l.src="http://www.ndhfilms.com/assets/images/closeButton.svg",e.appendChild(l)}let a=e("textarea").value,n=JSON.stringify(a);'"'===n.charAt(0)&&(n=n.slice(1)),n.charAt(n.length-1)&&(n=n.slice(0,n.length-1));let o=n.split("\\n"),d={title:"",subtitle:"",credit:"",author:"",illustrator:"",coverart:"",coverartdesc:"",coverlink:"",kywd:"",copyright:"",location:"",date:"",lang:"",icon:"",desc:"",keywords:"",audio:"",monetizelink:"",monetizeicon:"",small:"",stylesheet:[],menu:"",favorites:""},s=[],r=[],c=[],p="",h=!1,u=[],C=0,f=t("SECTION");f.id="footnoteSection";let g=!0;!function(){let e;function t(t){o[e].slice(0,t.length+2)==="!!"+t&&("small"===t.toLowerCase()?d.small="small":"stylesheet"===t.toLowerCase()?d.stylesheet.push(o[e].slice(0,12).replace(" ","_")):"audio"===t.toLowerCase()?7===o[e].length?d.audio="yes":d.audio=o[e].slice(7):d[t.toLowerCase()]=o[e].slice(t.length+3))}for(e=0;e<o.length;e+=1)"//"===o[e].slice(0,2)||""===o[e]?(o.splice(e,1),e>=2?e-=2:e=0):"!!"===o[e].slice(0,2)&&(["TITLE","SUBTITLE","CREDIT","AUTHOR","ILLUSTRATOR","COVERART","COVERARTDESC","KYWD","COPYRIGHT","LOCATION","DATE","LANG","ICON","DESC","KEYWORDS","AUDIO","MONETIZELINK","MONETIZEICON","SMALL","STYLESHEET","MENU","FAVORITES"].forEach(t),o.splice(e,1),e>=0?e-=1:0===e&&(e=0))}(),""!==d.monetizelink&&""===d.monetizeicon||""===d.monetizelink&&""!==d.monetizeicon?alert("Missing information for monetization."):""!==d.monetizelink&&""!==d.monetizeicon&&(p=(p=(p="<div id='monetizationDiv' class='buttons'><a href='[monetizationLink]'><img id='monetizationIcon'src='[monetizationIcon]' /></a></div>").replace("[monetizationLink]",d.monetizelink)).replace("[monetizationIcon]",d.monetizeicon)),o.forEach(function(e,t){if(4===e.length)o[t]=e.replace("****","[break]");else{e.includes("**")&&(o[t]=e.replace(/\*\*(.*?)\*\*/gm,"<b>$1</b>")),e.includes("*")&&(o[t]=o[t].replace(/\*(.*?)\*/gm,"<i>$1</i>"));let l=0;function i(e){if(o[t].includes(e)){let a,n=o[t].indexOf(e)+2,d="";"{{"===e?d=o[t].indexOf("}}"):"[["===e&&(d=o[t].indexOf("]]"));let s="";for(a=n;a<d;a+=1)s=s.concat(o[t][a]);let r=s.split("||"),c="";if("{{"===e){let e=r[0],t=r[1],i="";void 0!==r[2]&&(i=r[2].replace(" ","_"));let l="";void 0!==r[4]&&(l="download"),c="<a target='_blank' [download] id='"+i+"' href='"+e+"'>"+t+"</a>",""===i&&(c=c.replace("id=''","")),c=c.replace("[download]",l),""===l&&"#"!==e.charAt(0)||(c=c.replace("target='_blank'",""))}else if("[["===e){let e=r[0];c="<span id='"+r[1].replace(" ","_")+"'>"+e+"</span>"}if("{{"===e?o[t]=o[t].replace(/\{\{([^}]+)\}\}/,c):"[["===e&&(o[t]=o[t].replace(/\[\[([^}]+)\]\]/,c)),(l+=1)>=100)return void alert("You have probably forgotten to close a link. The resulting file will have issues.");i(e)}}i("{{"),i("[[")}});let m=t("HTML"),L="<html lang='[lang]'>";L=""!==d.lang?L.replace("[lang]",d.lang.toLowerCase()):L.replace("[lang]","en");let v=t("BODY");!function(){let e=t("HEAD"),i=t("META");i.httpEquiv="content-type",i.content="text/html; charset=utf-8",e.appendChild(i);let l=t("TITLE"),a=d.title+" "+d.credit+" "+d.author;if(""===d.credit&&(a=d.title+" by "+d.author),0===o.length&&(a="Empty E-Book"),l.text=a,e.appendChild(l),""!==d.author){let i=t("META");i.name="author",i.content=d.author,e.appendChild(i)}if(""!==d.desc){let i=t("META");i.name="description",i.content=d.desc,e.appendChild(i)}if(""!==d.keywords){let i=t("META");i.name="keywords",i.content=d.keywords,e.appendChild(i)}let n=t("META");if(n.name="theme-color",n.content="#fff5ee",e.appendChild(n),""===d.kywd&&""!==d.favorites)alert("WARNING: Designated a favorites-array,but no keyword for e-book");else if(""!==d.kywd&&""===d.favorites)alert("WARNING: Designated a keyword for e-book,but no favorites-array");else if(""!==d.favorites&&""!==d.kywd){let i=t("META");i.name="nameOfFavoritesArray";let l=d.favorites;i.content=l,e.appendChild(i);let a=t("META");a.name="keyword",a.content=d.kywd,e.appendChild(a)}function s(i){let l=t("LINK");l.rel="stylesheet",l.type="text/css",l.href=i,e.appendChild(l)}s("http://www.ndhfilms.com/assets/style/nantucket/nantucketStylesheet.css"),d.stylesheet.length>0&&d.stylesheet.forEach(function(e){s(e)});let r=t("LINK");r.rel="icon",r.type="image/gif";let c="http://www.ndhfilms.com/assets/images/walkingfavicon.gif";""!==d.icon&&(c=d.icon),r.href=c,e.appendChild(r);let p=t("LINK");p.rel="apple-touch-icon",p.sizes="57x57",p.href=c,e.appendChild(p);let h=t("LINK");h.rel="apple-touch-icon",h.sizes="180x180",h.href=c,e.appendChild(h),m.appendChild(e)}(),function(){let e=t("HEADER"),l=t("HGROUP");if(""!==d.title){let e=t("H1");e.id="title";let a=i(d.title);e.appendChild(a),l.appendChild(e)}if(""!==d.subtitle){let e=t("H2");e.id="subtitle";let a=i(d.subtitle);e.appendChild(a),l.appendChild(e)}if(""!==d.author){let e=t("H2");""===d.credit&&(d.credit="By");let a=i(d.credit+" "+d.author);e.appendChild(a),l.appendChild(e)}if(""!==d.illustrator){let e=t("H3"),a=i("Illustrated by "+d.illustrator);e.appendChild(a),l.appendChild(e)}if(""!==d.coverart){let e=t("H3"),a=i("Cover Art by "+d.coverart);e.appendChild(a),l.appendChild(e)}e.appendChild(l),v.appendChild(e)}(),function(){let e=t("DIV");e.classList.add("menuClosed"),e.id="buttonContainer";let i=["<div id='menuIconDiv' class='buttons' onclick=''><img id='menuIconImg' alt='Click or tap to toggle menu'src='http://www.ndhfilms.com/assets/images/menuicon_black.svg' /></div>","<div id='tocIconDiv' class='buttons' onclick=''><object id='tocIconObject'type='image/svg+xml'data='http://www.ndhfilms.com/assets/images/tocicon.svg'>Your browser does not support SVG</object></div>","<div id='lightbulbDiv' class='buttons' onclick=''><object ID='lightbulbObject'type='image/svg+xml'data='http://www.ndhfilms.com/assets/images/lightbulb.svg'>Your browser does not support SVG</object></div>","<div id='bookmarkDiv'class='buttons'><object id='bookmarkObject' type='image/svg+xml'data='http://www.ndhfilms.com/assets/images/bookmark.svg'>Your browser does not support SVG</object></div>","<div id='cassetteDiv' class='buttons'><object id='cassetteObject' type='image/svg+xml'data='http://www.ndhfilms.com/assets/images/cassette.svg'>Your browser does not support SVG</object></div>"];""!==p&&i.push(p),""!==d.favorites&&i.push("<div id='starDiv' class='buttons'><object id='starObject' type='image/svg+xml' data='../../assets/images/star.svg'>Your browser does not support SVG</object></div>");let l="";i.forEach(function(e){l=l.concat(e)}),e.innerHTML=l,v.appendChild(e)}(),""!==d.audio&&function(){let e=t("DIV");e.id="audioDiv",e.classList.add("standby");let a={},n=d.audio.split(" ");n.forEach(function(e,t){if(":background"===e)a.background=n[t+1];else if(":copyright"===e){let e=n.slice(t+1).join(" ");a.copyright=e}});let o=t("DIV");o.id="audioBackground",void 0!==a.background?o.style.backgroundImage="url('"+a.background+"')":o.style.backgroundColor="rgba(0,0,0,0)",e.appendChild(o);let s=t("DIV");s.id="audioContainer",s.classList.add("container");let r=t("DIV");r.id="audioIllustrationDiv",r.classList.add("flexbox1");let c=t("IMG");c.id="audioDivIllustration",r.appendChild(c);let p=t("HGROUP");p.classList.add("audioInfoHgroup");let h=t("H1"),u=i(d.title);h.appendChild(u),p.appendChild(h);let C=t("H2"),f=i(d.credit+" "+d.author);C.appendChild(f),p.appendChild(C);let g=t("H2");if(""!==a.copyright){let e="";e=void 0===a.copyright?"No copyright information available for this audiobook.":"public"===a.copyright.slice(0,6).toLowerCase()?"Audio Recording <s>&COPY</s> "+a.copyright:"Audio Recording &COPY; "+a.copyright,g.innerHTML=e,p.appendChild(g)}let m=t("H3"),L=t("A");L.id="audioCreditsLink",L.href="#creditsSection",L.onclick=!0;let b=i("CREDITS");L.appendChild(b),m.appendChild(L),p.appendChild(m),r.appendChild(p),s.appendChild(r);let I=t("DIV");I.id="audioCassetteDiv",I.classList.add("flexbox2");let y=t("DIV");y.id="cassetteAnimatedDiv";let E=t("OBJECT");E.id="cassetteAnimatedObject",E.type="image/svg+xml",E.data="http://www.ndhfilms.com/assets/images/cassetteAnimated.svg",y.appendChild(E),I.appendChild(y);let T=t("DIV");T.id="audioInterfaceWrapper",T.innerHTML="<object id='audioElement'type='image/svg+xml'data='http://www.ndhfilms.com/assets/images/audiointerface.svg'>Your browser does not support SVG</object></div>",I.appendChild(T),s.appendChild(I),e.appendChild(s),l(e,"audioCloseButton"),v.appendChild(e)}(),function(){let e=0;o.forEach(function(a,n){if("[break]"===a){let e=t("HR");e.classList.add("style-two"),v.appendChild(e)}else if("@@coverimg"===a.slice(0,10).toLowerCase()){let e=t("A");d.coverlink=a.slice(11),e.href=d.coverlink;let i=t("IMG");i.id="coverImg",""!==d.coverartdesc?(i.title=d.coverartdesc,i.alt=d.coverartdesc):(i.title="Cover of "+d.title,i.alt="Cover of "+d.title,""!==d.coverart&&(i.title=i.title.concat(" by "+d.coverart),i.alt=i.alt.concat(" by "+d.coverart))),i.src=d.coverlink,e.appendChild(i),v.insertBefore(e,v.childNodes[0]),s.push({link:"#coverImg",text:"Cover"})}else if("@@blockq"===a.slice(0,8).toLowerCase()){let e=a.slice(8);e=e.replace(/\\"/g,'"');let l=t("BLOCKQUOTE"),n=i(e);l.appendChild(n),v.appendChild(l)}else if("@@quoteattr"===a.slice(0,11).toLowerCase()){let e=" - "+a.slice(11);e=e.replace(/\\"/g,'"');let l=t("P");if(l.classList.add("blockquoteAttr"),e.includes("<i>"))l.innerHTML=e;else{let t=i(e);l.appendChild(t)}v.appendChild(l)}else if("@@support"===a.slice(0,9).toLowerCase()){let e=a.slice(9).split(" ");if(!1===e.includes(":title")||!1===e.includes(":text"))return void alert("@@SUPPORT section is missing required information");let l={title:"",text:""};e.forEach(function(t,i){let a="",n="",o=0;if(":title"===t){for(o=i+1;o<e.indexOf(":text");o+=1)a=a.concat(" "+e[o]);o=0,l.title=a}else if(":text"===t){for(o=i+1;o<e.length;o+=1)n=n.concat(" "+e[o]);o=0,l.text=n}});let n=t("SECTION");n.classList.add("endingSection"),n.id="supportSection";let o=t("H3");o.classList.add("sectionHeader");let d=i(l.title);o.appendChild(d),n.appendChild(o);let s=t("DIV");s.innerHTML=l.text,n.appendChild(s),v.appendChild(n)}else if("@@htmlstart"===a.slice(0,11).toLowerCase()){let e;for(h=!0,e=n+1;e<o.length&&"@@htmlend"!==o[e].toLowerCase();e+=1){let t=o[e].replace(/\\"/g,'"');u.push(t)}}else if("@@htmlend"===a.slice(0,9).toLowerCase()){h=!1;let e=t("DIV");e.classList.add("rawHTMLDiv");let i=u.join("");e.innerHTML=i,v.appendChild(e),u=[]}else if("@@img"===a.slice(0,5).toLowerCase()){let e=a.slice(5).split(" "),i={};e.forEach(function(t,l){if(":ornament"===t)i.ornament="ornament";else if(":source"===t)i.source=e[l+1];else if(":desc"===t){let t=e.slice(l+1);i.desc=t.join(" ")}});let l=t("IMG");l.classList.add("plainImage"),"ornament"===i.ornament&&l.classList.add("ornament"),l.src=i.source,void 0!==i.desc?l.alt=i.desc:l.alt="An image for "+d.title,v.appendChild(l)}else if("@@illo"===a.slice(0,6).toLowerCase()){e+=1;let n={},o=a.split(" ");!1===o.includes(":source")&&alert("required illustration data missing."),o.forEach(function(e,t){if(":source"===e)n.source=o[t+1];else if(":buy"===e)n.buy=o[t+1];else if(":caption"===e){let e=o.slice(t+1);e=(e=e.join(" ")).replace(/\\"/g,""),n.caption=e}else if(":orientation"===e)n.orientation=o[t+1];else if(":link"===e)n.link=o[t+1];else if(":illustrator"===e){let e,i="";for(e=t+1;e<o.length;e+=1)if(":"!==o[e].charAt(0))i=i.concat(" "+o[e]);else if(":"===o[e].charAt(0))break;n.illustrator=i}});let r="";r=e<10?"0"+e:e;let c=t("IMG");c.id="illustration"+r;let p={link:"#"+c.id};if(void 0===n.caption)p.text="Image No. "+(s.length+1);else{let e=n.caption;p.text=e}s.push(p);let h="Illustration for "+d.title;if(c.title=h,c.alt=h,void 0!==n.illustrator&&""!==n.illustrator){let e=" , illustration by "+n.illustrator;c.title=c.title.concat(e),c.alt=c.alt.concat(e)}c.classList.add("illustrationTarget"),"portrait"===n.orientation?c.classList.add("thumbnailPortrait"):"landscape"===n.orientation&&c.classList.add("thumbnailLandscape"),c.src=n.source,v.appendChild(c);let u=t("IMG");u.classList.add("enlargeIcon"),u.alt="Click or tap to enlarge illustration",u.src="http://www.ndhfilms.com/assets/images/enlargeicon_black.svg",v.appendChild(u);let C=t("DIV");C.classList.add("illustrationDiv"),C.classList.add("standby"),l(C);let f=t("DIV");f.classList.add("container");let g=t("DIV");g.classList.add("flexbox1");let m=t("IMG");m.classList.add("illustration"),m.classList.add(n.orientation+"Illustration"),m.alt="Illustration for "+d.title+" by "+n.illustrator,m.title="Illustration by "+n.illustrator,m.src=n.source,g.appendChild(m),f.appendChild(g);let L=t("DIV");L.classList.add("illustrationCaptionDiv"),L.classList.add("flexbox2");let b=t("HGROUP");b.classList.add("illustrationCaption");let I=t("H2"),y=i("Image #"+s.length+" for this E-Book.");if(void 0!==n.caption&&(y=i(n.caption)),I.appendChild(y),b.appendChild(I),void 0!==n.illustrator){let e=t("H3"),l=i("Illustration by ");if(e.appendChild(l),void 0!==n.link){let l=t("A");l.href=n.link;let a=i(n.illustrator);l.appendChild(a),e.appendChild(l)}else{let t=i(n.illustrator);e.appendChild(t)}b.appendChild(e)}L.appendChild(b),f.appendChild(L),C.appendChild(f),v.appendChild(C)}else if("@@audio"===a.slice(0,7).toLowerCase()){let e={},t=a.slice(7).split(" ");t.forEach(function(i,l){if(":source"===i)e.source=t[l+1];else if(":title"===i){let i=t.slice(l+1).join(" ");e.title=i}}),c.push(e)}else if("#"===a.slice(0,1)){let e="",l="",d="";if("#"===a.charAt(0)&&"#"!==a.charAt(1)){e=t("H1");let i=(l=a.slice(1)).replace(" ","_");e.id=i;let s={link:"#"+i};void 0!==o[n+1]&&"##"===o[n+1].slice(0,2)&&(d=": "+o[n+1].slice(2)),s.text=l+d,r.push(s)}else"#"===a.charAt(0)&&"#"===a.charAt(1)&&(e=t("H2"),l=a.slice(2));e.classList="chapterHeading";let s=i(l);e.appendChild(s),v.appendChild(e)}else if("`"===a.slice(0,1)){let e=t("P");e.classList.add("lyricalP");let i=1;"``"===a.slice(0,2)&&(i=2,e.classList.add("endOfVerse")),e.innerHTML=a.slice(i).replace(/\\"/g,'"'),v.appendChild(e)}else if("@@ded"===a.slice(0,5).toLowerCase()){let e=t("P");e.classList.add("dedication");let l=i(a.slice(5));e.appendChild(l),v.appendChild(e)}else if("@@fn"===a.slice(0,4).toLowerCase()){let e=t("P"),i=a.slice(4),l=f.children.length+1,n="<a id='footnote"+l+"' href='#footnoteLink"+l+"'><sup>"+l+"</sup></a>"+i;e.innerHTML=n,f.appendChild(e)}else if(!1===h){let e=t("P"),i="";":left"===a.slice(0,5)?(e.classList.add("alignLeft"),i=(i=a.slice(5)).replace(/\\"/g,'"')):":center"===a.slice(0,7)?(e.classList.add("alignCenter"),i=(i=a.slice(7)).replace(/\\"/g,'"')):":right"===a.slice(0,6)?(e.classList.add("alignRight"),i=(i=a.slice(6)).replace(/\\"/g,'"')):i=a.replace(/\\"/g,'"'),g?(i="<span class='dropcap'>"+i.slice(0,1)+"</span>"+i.slice(1),e.innerHTML=i,g=!1):e.innerHTML=i,e.innerHTML.toLowerCase().includes("<fn>")&&(C+=1,e.innerHTML=e.innerHTML.replace("<fn>","<a id='footnoteLink"+C+"' href='#footnote"+C+"'><sup>"+C+"</sup></a>")),v.appendChild(e)}})}(),function(){let e=t("LABEL");e.setAttribute("for","tocSelect");let a=i("Some text here");e.appendChild(a);let n=t("SELECT");n.id="tocSelect",n.classList.add("selectClosed");let o=t("OPTION");o.id="firstOption",o.value="placeholder";let c=i("TABLE OF CONTENTS");o.appendChild(c),n.appendChild(o);let p=t("DIV");p.id="tableOfContents",p.classList.add("tocStandby"),p.onclick=!0;let h=t("H1");h.classList.add("tocHeader");let u=i("TABLE OF CONTENTS");h.appendChild(u),p.appendChild(h);let C=t("DIV");C.id="tocMobileDiv";let f=t("UL");f.id="tocList",C.appendChild(f),p.appendChild(C);let g=t("SECTION");g.id="tableOfContentsSection";let m=t("H2"),L=i("TABLE OF CONTENTS");m.appendChild(L),g.appendChild(m);let b=t("UL");function I(e,l){if(e.length>0){let a=t("OPTION");a.value="placeholder";let o="ILLUSTRATIONS";"chapters"===l&&(o="SECTIONS");let d=i("-- "+o+" --");a.appendChild(d),n.appendChild(a);let s=t("LI");s.classList.add("listHeading");let r=t("H3"),c=i(o);r.appendChild(c),s.appendChild(r),f.appendChild(s);let p=t("LI");p.classList.add("listHeading");let h=t("H3"),u=i(o);h.appendChild(u),p.appendChild(h),b.appendChild(p),e.forEach(function(e,a){let o=t("OPTION");o.value=e.link;let d=i(e.text);o.appendChild(d),n.appendChild(o);let s=t("LI");"illustrations"===l&&"Cover"!==e.text&&s.classList.add("listItalic");let r=t("A");r.classList.add("tocLink"),r.href=e.link;let c=i(e.text);r.appendChild(c),s.appendChild(r),f.appendChild(s);let p=t("LI");"illustrations"===l&&"Cover"!==e.text&&p.classList.add("listItalic");let h=t("A");h.href=e.link;let u=i(e.text);h.appendChild(u),p.appendChild(h),b.appendChild(p)})}}I(s,"illustrations"),I(r,"chapters"),l(p,"tocCloseButton"),g.appendChild(b),(r.length>0||s.length>0)&&(v.appendChild(e),v.getElementsByTagName("HEADER")[0].parentNode.insertBefore(n,v.getElementsByTagName("HEADER")[0].nextSibling),v.getElementsByTagName("HEADER")[0].parentNode.insertBefore(p,v.getElementsByTagName("HEADER")[0].nextSibling),"small"!==d.small&&v.getElementsByTagName("HEADER")[0].parentNode.insertBefore(g,v.getElementsByTagName("HEADER")[0].nextSibling))}();let b=t("DIV");b.id="audioSourceMenu",b.classList.add("audioSourceMenuStandby");let I=t("HGROUP");if(""!==d.title){let e=t("H1"),l=i(d.title);if(e.appendChild(l),I.appendChild(e),""!==d.subtitle){let e=t("H2"),l=i(d.subtitle);e.appendChild(l),I.appendChild(e)}if(""!==d.author){let e=t("H3"),l="";l=""!==d.credit?i(d.credit+" "+d.author):i("by "+d.author),e.appendChild(l),I.appendChild(e)}}let y=t("H1");y.id="audioSourceMenuHeader";let E=i("CHOOSE AN AUDIO FILE");y.appendChild(E),I.appendChild(y),b.appendChild(I);let T=t("DIV");T.id="audioListDiv";let S=t("UL");if(S.id="audioSourceList",0===c.length)v.querySelector("#cassetteDiv").remove(),null!==v.querySelector("#audioDiv")&&v.querySelector("#audioDiv").remove();else{c.forEach(function(e){let l=t("LI");l.title=e.source;let a=i(e.title);l.appendChild(a),S.appendChild(l)});let e=t("P");e.id="currentAudio";let a="CHOOSE AN AUDIO FILE &#9757;";e.innerHTML=a,c.length>0&&(T.appendChild(S),b.appendChild(T),l(b)),v.querySelector("#audioCassetteDiv").insertBefore(e,v.querySelector("#audioCassetteDiv").childNodes[0]),v.insertBefore(b,v.querySelector("#audioDiv"))}if(""!==d.date&&function(){let e=t("UL");e.classList.add("mainTextUL"),e.id="endingDate";let l=t("LI"),a=i(d.location);l.appendChild(a);let n=t("LI"),o=d.date,s=o.trim().split("-"),r=["January","February","March","April","May","June","July","August","September","October","November","December"],c=s[0],p="";void 0!==s[1]&&(p=r[parseInt(s[1])-1]+" ");let h="";void 0!==s[2]&&("0"===(h=s[2]).charAt(0)&&(h=h.slice(1)),h="1"===h||"21"===h||"31"===h?h.concat("<sup>st</sup>"):"2"===h||"22"===h?h.concat("<sup>nd</sup>"):"3"===h||"23"===h?h.concat("<sup>rd</sup>"):h.concat("<sup>th</sup>"),h+=", "),t("TIME").datetime=o,n.innerHTML=p+h+c,e.appendChild(l),e.appendChild(n),null!==v.querySelectorAll("#supportSection")?v.insertBefore(e,v.querySelectorAll("#supportSection")[0]):v.appendChild(e)}(),o.length>0&&function(){let e=t("P");if(e.id="copyrightNotice",e.classList.add("center"),""!==d.copyright){let t=d.copyright.split(" "),i=t[0],l="TEXT &COPY; ",a="<time datetime='"+i+"'>"+i+"</time>",n=t.slice(1).join(" ");e.innerHTML="PUBLIC"===i?"TEXT <s>&COPY;</s> PUBLIC DOMAIN":l+a+" "+n}else e.innerHTML="No copyright information available at this time";null!==v.querySelectorAll("#supportSection")?v.insertBefore(e,v.querySelectorAll("#supportSection")[0]):v.appendChild(e)}(),o.length>0&&function(){let e=t("SECTION");e.classList.add("endingSection"),e.id="creditsSection";let l=t("H3");l.classList.add("sectionHeader");let a=i("CREDITS");l.appendChild(a),e.appendChild(l);let n=t("UL");n.classList.add("mainTextUL"),n.id="creditsList";let o=t("LI"),s=i("Written by "+d.author);if(o.appendChild(s),n.appendChild(o),""!==d.coverart){let e=t("LI"),l=i("Cover Art by "+d.coverart);e.appendChild(l),n.appendChild(e)}if(""!==d.illustrator){let e=t("LI"),l=i("Illustrated by "+d.illustrator);e.appendChild(l),n.appendChild(e)}e.appendChild(n),v.appendChild(e)}(),function(){let e=t("P");e.id="eReaderNotice";let l=i("This e-Reader was developed by Nicholas Bernhard. No part of the source code or user interface can be used without explicit permission from the developer. For licensing information, send an email to Nicholas[at]NDHFilms[dot][com].");e.appendChild(l),v.appendChild(e)}(),f.children.length>0){let e=t("H3");e.classList.add("sectionHeader");let l=i("FOOTNOTES");e.appendChild(l),f.insertBefore(e,f.children[0]),v.insertBefore(f,v.querySelectorAll("#eReaderNotice")[0])}function A(e,l){let a=t("OPTION");a.value=e;let n=i(l);a.appendChild(n),void 0!==v.querySelectorAll("#tocSelect")[0]&&v.querySelectorAll("#tocSelect")[0].appendChild(a);let o=t("LI"),d=t("A");d.classList.add("tocLink"),d.href=e;let s=i(l);if(d.appendChild(s),o.appendChild(d),void 0!==v.querySelectorAll("#tocList")[0]&&v.querySelectorAll("#tocList")[0].appendChild(o),null!==v.querySelectorAll("#tableOfContentsSection")){let a=t("LI"),n=t("A");n.href=e;let o="";o=i("Back To Menu"===l?"-- BACK TO MENU --":l),n.appendChild(o),a.appendChild(n),void 0!==v.querySelectorAll("#tableOfContentsSection")[0]&&v.querySelectorAll("#tableOfContentsSection")[0].children[1].appendChild(a)}}if(void 0!==v.querySelectorAll("#supportSection")&&"object"!=typeof v.querySelectorAll("#supportSection")&&A("#supportSection",v.querySelectorAll("#supportSection")[0].children[0].innerText),null!==v.querySelectorAll("#creditsSection")&&o.length>0&&A("#creditsSection","CREDITS"),o.length>0&&A("#eReaderNotice","NDH E-READER COPYRIGHT NOTICE"),f.children.length>0&&A("#footnoteSection","Footnotes"),""!==d.menu&&A(d.menu,"Back to Menu"),""!==d.audio&&(v.querySelectorAll("#audioDivIllustration")[0].src=d.coverlink),function(){let e=t("SCRIPT");e.src="http://www.ndhfilms.com/assets/scripts/nantucket/ahab-min.js",v.appendChild(e)}(),0===o.length&&""===v.querySelectorAll("HEADER")[0].children[0].innerHTML){let e=t("H1");e.classList.add("chapterHeading");let l=i("GEE...");e.appendChild(l),v.insertBefore(e,v.querySelectorAll("#eReaderNotice")[0]);let a=t("P"),n=i("It sure is boring around here.");a.appendChild(n),v.insertBefore(a,v.querySelectorAll("#eReaderNotice")[0])}m.appendChild(v),function(i,l){let a=new Blob([l],{type:"text/html;charset=UTF-8"}),n=URL.createObjectURL(a),o="";!function(){let e=new Date,t=e.getFullYear()+"-",i=e.getMonth()+1;i<10&&(i="0"+i+"-");let l=e.getDate();l<10&&(l="0"+l),o=o.concat(t,i,l)}();let d=t("A"),s=i+"_"+o+".html";d.download=s,d.href=n,d.textContent=s,d.click(),e("inputOutputContainer").appendChild(d),e("inputOutputContainer").innerHTML=""}(localStorage.getItem("lastFileOpened"),"<!DOCTYPE html>"+L+m.innerHTML+"</html>")}